# dbsql
Various SQL tasks
## Task 1
Задание 1
Создайте таблицу staff с тремя полями:
id – целое число, являющееся первичным ключом;
name – не пустая строка, длина которой не превышает 64 символов;
department – не пустая строка, длина которой не превышает 64 
символов.


Задание 2
Создайте последовательность staff_id_seq так, чтобы она:
начиналась с числа 12;
была цикличной;
генерировала числа в порядке возрастания с шагом 8;
поддерживала кэширование в 100 элементов.


Задание 3
Напишите запрос, добавляющий в таблицу staff одну новую строку, 
заполненную следующим образом:
в поле id записывается следующий элемент последовательности 
staff_id_seq;
в поле name записывается 'Ivan Makarenko';
в поле department записывается 'Director'.


Задание 4
Напишите запрос, добавляющий в таблицу staff столько новых строк, сколько 
их в таблице emploeeys. Каждая добавляемая строка заполняется по 
следующему принципу:
в поле id записывается следующий элемент последовательности 
staff_id_seq;
в поле name записывается значение поля last_name таблицы employees;
в поле department записывается значение поля department_name
таблицы departments из строки, у которой значение поля department_id
совпадает со значением поля department_id строки таблицы employees,
из которой взято значение поля name.


Задание 5
Напишите запрос, заменяющий в таблице staff значение поля departmet всех 
строк с id < 40 на 'Innovations department'.


Задание 6
Напишите запрос, удаляющий в таблице staff все записи, у которых поле name
содержит букву 'K'.

Задание 8
По заданному идентификатору менеджера выведите на экран всех его 
подчинённых, включая косвенных подчинённых любого уровня (подчинённых 
через подчинённых).

## Task 2
Задание 1
Напишите запрос, находящий всех сотрудников (таблица 
bd_employees), у которых в номерах телефонов есть три цифры, 
заключённые в круглые скобки. Например, «8-(912)-123-45-67».


Задание 2
Напишите запрос, выбирающий фамилию сотрудника (поле 
last_name), улицу (поле street) и индекс (поле postal_code) отдела в 
котором он работает для всех отделов, у которых индекс состоит из 
шести цифр и первый три цифры – это записанные в обратном 
порядке последние три цифры. Например, «123321».


Задание 3
Напишите запрос, выбирающий фамилию сотрудника (поле 
last_name) и его адрес электронной почты (поле email) для всех 
сотрудников. Причем в адресе электронной почты домен третьего 
уровня (если он есть) должен заменяться на «mywork». Например, 
«vyradigin@f.mail.mephi.ru» должен быть заменён на 
«vyradigin@f.mywork.mephi.ru».


Задание 4
A. Напишите запрос, выдающий пользователю, 
принадлежащему вашему напарнику(це) по подгруппе, 
выполняющей данную лабораторную работу, права на все 
действия с таблицей bd_departments.
B. Напишите запрос, выдающий пользователю, 
принадлежащему вашему напарнику(це) по подгруппе, 
выполняющей данную лабораторную работу, права на 
выборку из таблицы bd_employees.
C. Напишите запрос, забирающий у пользователя, 
принадлежащего вашему напарнику(це) по подгруппе, 
выполняющей данную лабораторную работу, права на 
удаление и изменение строк из таблицы bd_departments.


Задание 5
Напишите запрос, выбирающий всех сотрудников, у которых в 
фамилии гласных букв в два раза меньше, чем согласных


##Task 3
Задание 1
a) Напишите запрос, используя конструкцию WITH, выбирающий 
рекурсивно сотрудника с идентификатором 6 и всех его руководителей, 
как прямых, так и более высокого ранга*.
b) Напишите программу на языке PL/SQL, печатающую на экран фамилию 
и имя сотрудника с идентификатором 6 и всех его руководителей, как 
прямых, так и более высокого ранга.


Задание 2
Напишите программу на языке PL/SQL, выбирающую с помощью 
курсора все строки из таблицы employees в порядке возрастания заработной 
платы (salary) и печатающие на экран следующие данные: фамилия, имя, 
модифицированная заработная плата. Модифицированная заработная плата 
получается следующим образом: у первого по порядку сотрудника она 
округляется до сотен в меньшую сторону, а у всех последующих сотрудников 
она сначала увеличивается на остаток от округления, полученный от 
предыдущего сотрудника, а затем округляется до сотен в меньшую сторону.


Задание 3 
Напишите программу на языке PL/SQL, удаляющую 10 сотрудников с 
самой маленькой заработной платой. При этом их заработная плата должна 
добавиться 10 сотрудникам с самой большой заработной платой. Причём 
самая маленькая заработная плата должна добавиться к человеку с самой 
большой заработной платой. 2-я с конца заработная плата должна добавиться 
к человеку со второй по размеру заработной платой и т.д.


Задание 4
Создайте таблицу spiral с 5 полями f1, f2, f3, f4, f5 – целые числа. 
Напишите программу на языке PL/SQL, заполняющую данную таблицу 1000 
строк по следующему принципу:
1 3 5 7 9
2 4 6 8 10
20 18 16 14 12
19 17 15 13 11
21 23 25 27 29

##Task 4
Задание 1
• Создайте две таблицы: operations и operations_log. Первая таблица
должна содержать поля идентификатор (id), номер счёта
(account_number), номер документа (document_number), название
операции (operation_name), код операции (operation_code) сумма по
операции (operation_sum). Поле id – это первичный ключ. Поле 
operation_sum – это действительное число. Вторая таблица должна 
содержать поля: идентификатор операции (operation_id), номер счёта
(account_number) дата операции (operation_date), тип операции
(operation_type). Поле operation_date должно позволять сохранять дату 
и время. Поле operation_type может содержать только два значения ‘-‘, 
‘+’. Заполните таблицы operations и operations_log несколькими 
записями (не менее 5 на таблицу).


Задание 2
• Напишите процедуру или функцию statement_of_acount, которая на 
основе трёх параметров: даты начала периода, даты окончания периода 
и номера счёта печатала бы на экран данные по каждой операции из 
таблиц operations и operations_log за указанный период (тип операции, 
сумма, дата операции). В конце должна печататься информация об
общем числе операций и две суммы: все положительные и все 
отрицательные операции.


Задание 3
• Напишите процедуру или функцию account_operation, которая на 
основе трёх параметров: номера счёта, идентификатора и суммы 
вносит изменения в таблицы operations и operations_log. В таблицу
operations должна добавляться запись, где поля идентификатор, номер 
счёта и сумма по операции должны заполняться переданными 
параметрами. Поля номер документа, код операции и название 
операции заполняются следующим образом: если сумма операции > 0, 
то это (‘12345’, ‘1’, ‘внесение денег на счёт’) иначе это (‘12346’, ‘2’, 
‘снятие денег со счёта’)
